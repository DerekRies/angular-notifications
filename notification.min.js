"use strict";angular.module("notifications",[]).factory("$notification",["$timeout",function(a){function b(a,b,c,d,f){if(0===window.webkitNotifications.checkPermission()){a||(a="favicon.ico");var g=window.webkitNotifications.createNotification(a,b,c);"function"==typeof d&&(g.ondisplay=d),"function"==typeof f&&(g.onclose=f),g.show()}else e.html5Mode=!1}console.log("notification service online");var c=JSON.parse(localStorage.getItem("$notifications"))||[],d=[],e={info:{duration:5e3,enabled:!0},warning:{duration:5e3,enabled:!0},error:{duration:5e3,enabled:!0},success:{duration:5e3,enabled:!0},progress:{duration:0,enabled:!0},custom:{duration:35e3,enabled:!0},details:!0,localStorage:!1,html5Mode:!1,html5DefaultIcon:"icon.png"};return{disableHtml5Mode:function(){e.html5Mode=!1},disableType:function(a){e[a].enabled=!1},enableHtml5Mode:function(){e.html5Mode=this.requestHtml5ModePermissions()},enableType:function(a){e[a].enabled=!0},getSettings:function(){return e},toggleType:function(a){e[a].enabled=!e[a].enabled},toggleHtml5Mode:function(){e.html5Mode=!e.html5Mode},requestHtml5ModePermissions:function(){return window.webkitNotifications?(console.log("notifications are available"),0===window.webkitNotifications.checkPermission()?!0:(window.webkitNotifications.requestPermission(function(){e.html5Mode=0===window.webkitNotifications.checkPermission()?!0:!1}),!1)):(console.log("notifications are not supported"),!1)},getAll:function(){return c},getQueue:function(){return d},info:function(a,b,c){return console.log(a,b),this.awesomeNotify("info","info",a,b,c)},error:function(a,b,c){return this.awesomeNotify("error","remove",a,b,c)},success:function(a,b,c){return this.awesomeNotify("success","ok",a,b,c)},warning:function(a,b,c){return this.awesomeNotify("warning","exclamation",a,b,c)},awesomeNotify:function(a,b,c,d,e){return this.makeNotification(a,!1,b,c,d,e)},notify:function(a,b,c,d){return this.makeNotification("custom",a,!0,b,c,d)},makeNotification:function(f,g,h,i,j,k){var l={type:f,image:g,icon:h,title:i,content:j,timestamp:+new Date,userData:k};return c.push(l),e.html5Mode?b(g,i,j,function(){console.log("inner on display function")},function(){console.log("inner on close function")}):(d.push(l),a(function(){d.splice(d.indexOf(l),1)},e[f].duration)),this.save(),l},save:function(){e.localStorage&&localStorage.setItem("$notifications",JSON.stringify(c))},restore:function(){},clear:function(){c=[],this.save()}}}]).directive("notifications",["$notification","$compile",function(a){function b(a,b,c){var d=c.notifications;d=d.split(" "),b.addClass("dr-notification-container");for(var e=0;e<d.length;e++)b.addClass(d[e])}console.log("this is a new directive");var c='<div class="dr-notification-wrapper" ng-repeat="noti in queue"><div class="dr-notification-close-btn" ng-click="removeNotification(noti)"><i class="icon-remove"></i></div><div class="dr-notification"><div class="dr-notification-image dr-notification-type-{{noti.type}}" ng-switch on="noti.image"><i class="icon-{{noti.icon}}" ng-switch-when="false"></i><img ng-src="{{noti.image}}" ng-switch-default /></div><div class="dr-notification-content"><h3 class="dr-notification-title" ng-bind="noti.title"></h3><p class="dr-notification-text" ng-bind-html-unsafe="noti.content"></p></div></div></div>';return{restrict:"A",scope:{},template:c,link:b,controller:["$scope",function(b){b.queue=a.getQueue(),b.removeNotification=function(a){b.queue.splice(b.queue.indexOf(a),1)}}]}}]);